<!DOCTYPE html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=yes">
    <meta charset="utf-8">
    <title>ODX</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.15/themes/css/cartodb.css" />
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
 	<!-- <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script> -->
	<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
	<script src="lib/d3.min.js"></script>
<style>
   path {
    fill: #000;
    fill-opacity: .2;
    stroke: #003399;
    stroke-width: 1.5px;
  }

  path:hover {
    fill: brown;
    fill-opacity: .7;
  }
  html, body {
    height: 100%;
    margin: 0;
  }
  
  #mapid{
   
    height:100%;
  }
</style>
</head>

<body>

<div id="mapid"></div>

<script type="text/javascript">

var mymap = L.map('mapid')
mymap.setView(new L.LatLng(42.351486,-71.066829), 13);
L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png').addTo(mymap);

// possible tile values 
// light_all,
// dark_all,
// light_nolabels,
// light_only_labels,
// dark_nolabels,
// dark_only_labels
var svg = d3.select(mymap.getPanes().overlayPane)
	.append("svg")
    g= svg.append("g").attr("class", "leaflet-zoom-hide");

d3.json("lib/ma_towns.json", function(collection) {

// create a d3.geo.path to convert GeoJSON to SVG
var transform = d3.geoTransform({point: projectPoint}),
    path = d3.geoPath().projection(transform);
// create path elements for each of the features using D3’s data join
var feature = g.selectAll("path")
    .data(collection.features)
  	.enter().append("path")


mymap.on('zoom',mapreset)
mymap.on('viewreset',mapreset)
mapreset()


function mapreset(){
	// convert the longitude and latitude to pixels
var bounds = path.bounds(collection),
    topLeft = bounds[0],
    bottomRight = bounds[1];
svg .attr("width", bottomRight[0] - topLeft[0])
    .attr("height", bottomRight[1] - topLeft[1])
    .style("left", topLeft[0] + "px")
    .style("top", topLeft[1] + "px");
g.attr("transform", "translate(" + -topLeft[0] + "," + -topLeft[1] + ")");
// initialize the path
feature.attr("d", path);
}
// This code adapts Leaflet’s latLngToLayerPoint and LatLng methods to project a single point, passing the resulting coordinates to an output geometry stream.
function projectPoint(x, y) {
  var point = mymap.latLngToLayerPoint(new L.LatLng(y, x));
  this.stream.point(point.x, point.y);
}


});

</script>

</body>
</html>