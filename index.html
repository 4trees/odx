<!DOCTYPE html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=yes">
    <meta charset="utf-8">
    <title>ODX</title>
    <!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script> -->
    <link rel="stylesheet" type="text/css" href="lib/bootstrap-3.3.5/bootstrap.min.css" >
  	<link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.15/themes/css/cartodb.css" />
  	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
    <link rel="stylesheet" href="lib/font-awesome-4.4.0/css/font-awesome.min.css">
    <script src="lib/angular-1.4.8/angular.min.js"></script>
  	<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script src="app.js"></script>
    <script src="icon.js"></script>
  	<script src="lib/d3.min.js"></script>
<style>
  html, body {
    height: 100%;
    font-size:10px;
    font-family: Verdana, Geneva, sans-serif;
  }
  .container-fluid,#content{
    height:100%;
  }
  #content{
    padding-top: 50px;
  }
  .nav{
    background: #f7f7f7;
    box-shadow: 0px 1px 1px #999;
    padding: 10px;
    z-index: 1001;
    position: fixed;
    width: 100%;
  }
  #preview{
    width: 20%;
    right: 0;
    height: 100%;
    z-index: 1000;
    position: fixed;
  }
  .panel{
    margin:10px 10px 0 0;
    max-height: 100%;
    background: #fff;
    /*box-shadow: 0px 1px 1px #999;*/
  }

  #mapid{
    width: 100%;
    height: 100%;
    position: fixed;
  }
  .stop{
    stroke: #333;
    stroke-width:.5;
    fill:#333;
    fill-rule: nonzero;
  }
  .path{
  	stroke: #999;
  	stroke-width:2;
  	fill:none;
  }
  .selected{
  	fill: #333;
    stroke-width:10;
  }
  .leaflet-popup-content-wrapper, .leaflet-popup-tip{
  	background: #fff;
  	opacity: .9;
  	color: #333;
  }
  .leaflet-popup-content-wrapper{
  	border-radius: 4px;
  }
  .leaflet-popup-content{
  	margin: 10px;
  }
  .leaflet-popup-close-button{
    color: #000;
  }
  .routelabel{
    padding: 3px 5px;
    margin-right: 5px;
    border-radius: 3px;
  }
  #selectedlist{
    padding-top: 5px;
  }
  .selectedlist{
    list-style-type:none;
    margin: 0;
    padding: 0;
    display: inline-flex;
  }
  .delete{
    border: none;
    background: none;
  }
  hr{
    color:#eee;
    margin:10px 0;
  }
/*  dt{
    font-weight: normal;
    line-height: 300%;
  }
  dd{
    font-size: 120%;

  }*/
  #preview .dl-horizontal dt{
    text-align: left;
  }
  #preview .dl-horizontal{
    margin-bottom: 0;
  }
  #preview .panel-body{
    padding-top: 10px;
  }
  #stopsummary .stopname{
    font-size: 150%;
    margin:15px 0 20px 0;
  }
  #preview .checkbox label{
    display: block;
  }
  #preview .checkbox{
    /*margin: 0;*/
  }
  #preview .dropdown button{
    width: 100%;
  }
  .filters{
    margin:30px 0;
  }
  .filter{
    margin-bottom:15px;
  }
</style>
</head>
<nav>
    <div class="nav">
        <div class="input-group input-group-sm" id="searchBar">
            <input type="text" class="form-control" name="route" placeholder="stop, route, shape..." ng-model="route" value={{route}}>
        </div>
    </div>
</nav>
<body ng-app="spApp" ng-controller="spAppController">
<div class="container-fluid">
    <div class="row" id="content">
      <div id="mapid"></div>
      <div id="preview">
          <div class="panel panel-default">
              <div class="panel-heading">
                <dl class="dl-horizontal">
                 <dt>Selected<dt><dd class="text-right">1 stop(s)</dd>
                </dl>
              </div>
              <div class="panel-body">
                  <section id="stopsummary">
                    <dl class="dl-horizontal">
                      <dt>Stop<dt><dd class="text-right"></dd>
                    </dl>
                      <p class="stopname">Copley</p>
                      <div>
                          <p>Route(s)</p>
                          <div class="checkbox">
                            <label>
                              <input type="checkbox" value="Green Line E" name="route3000" checked>
                              <p>Green Line E</p>
                            </label>
                            <label>
                              <input type="checkbox" value="39" name="route39" checked>
                              39
                            </label>
                          </div>                          
                      </div>
                  </section>
                  <hr>
                  <section id="routesummary">
                    
                  </section>
                  <section id="analysis">
                      <dl class="dl-horizontal">
                         <dt>Analysis<dt><dd class="text-right"><a href="">view report</a></dd>
                      </dl>
                          <div class="filters">
                          <!-- day filter -->
                            <div class="filter dropdown">
                              <button class="btn btn-default dropdown-toggle btn-xs" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                Everyday
                                <span class="caret"></span>
                              </button>
                              <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1">
                                <li><a href="#">SA</a></li>
                                <li><a href="#">SU</a></li>
                                <li><a href="#">Weekday</a></li>
                                <li><a href="#">Weekend</a></li>
                                <li><a href="#">Everyday</a></li>
                              </ul>
                            </div>
                            <!-- direction filter -->
                            <div class="filter dropdown">
                              <button class="btn btn-default dropdown-toggle btn-xs" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                All directions
                                <span class="caret"></span>
                              </button>
                              <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1">
                                <li><a href="#">Inbound</a></li>
                                <li><a href="#">Outbound</a></li>
                                <li><a href="#">All directions</a></li>
                              </ul>
                            </div>
                            <!-- time filter -->
                            <div class="filter dropdown">
                              <button class="btn btn-default dropdown-toggle btn-xs" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                Time period
                                <span class="caret"></span>
                              </button>
                              <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1">
                                <!-- <li><a href="#">Inbound</a></li> -->
                                <!-- <li><a href="#">Outbound</a></li> -->
                              </ul>
                            </div>
                          </div>
                      <div id="odx">
                          <p>ODX</p>
                      </div>
                      <div id="stage">
                          <p>Stage</p>
                      </div>
                  </section>
              </div>
          </div>
      </div>
    </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="lib/bootstrap-3.3.5/bootstrap.min.js"></script>
<script type="text/javascript">

var odxdata = [{o:12,d:23,x:12}]
    stagedata = [{1:32,2:3,3:12}]
    odxKey = Object.keys(odxdata[0])
    stageKey = Object.keys(stagedata[0])


var w = d3.select('.panel-body').select('section').node().clientWidth;

var fullWidthScale = d3.scaleLinear()
    .range([0,w])
  
var stack = d3.stack()
    .order(d3.stackOrderNone)
    .offset(d3.stackOffsetNone);

var colorForODX = d3.scaleOrdinal()
  .domain(odxKey)
  .range(['yellow','pink','blue'])
var colorForstage = d3.scaleOrdinal()
  .domain(stageKey)
  .range(['green','orange','red'])

drawStackedChart('odx',odxKey, odxdata,colorForODX)
drawStackedChart('stage',stageKey, stagedata,colorForstage)

function drawStackedChart(type, key, data, color){
  var plot = d3.select('#' + type)
  var svg = plot.append('svg')
    .attr('height', '50px')
    .attr('width',w)

  stack.keys(key)

  fullWidthScale
    .domain([0, d3.sum(Object.values(data[0]))])

  var updateElement = svg.selectAll('element')
    .data(stack(data))
  var enterElement = updateElement.enter()
    .append('g').attr('class','element')
  enterElement.append('rect')
    .attr('y', 0)
    .attr('x', function(d,i){return fullWidthScale(d[0][0])})
    .attr('width', function(d,i) {return fullWidthScale(d[0][1] - d[0][0])})
    .attr('height', '25px')
    .style('fill',function(d){return color(d.key)})
  enterElement.append('text')
    .attr('y', '35px')
    .attr('x', function(d,i){return fullWidthScale((d[0][0] + d[0][1]) / 2)})
    .text(function(d){return d.key})
}


</script>
</body>
</html>